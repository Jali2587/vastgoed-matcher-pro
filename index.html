<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vastgoed Matcher Pro AI</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Plus, Users, Building, Star, Filter, Mail, Phone, MapPin, Euro, TrendingUp, Calendar, AlertCircle, LogOut, User, Brain, Search, FileText, Target, Zap, DollarSign, UserCheck, Award, Settings, Edit } = lucide;

        const VastgoedInvesteerderMatcher = () => {
          const [user, setUser] = useState(null);
          const [activeTab, setActiveTab] = useState('dashboard');
          const [investors, setInvestors] = useState([]);
          const [deals, setDeals] = useState([]);
          const [transactions, setTransactions] = useState([]);
          const [users, setUsers] = useState([]);
          const [matches, setMatches] = useState([]);
          const [showAddInvestor, setShowAddInvestor] = useState(false);
          const [showAddDeal, setShowAddDeal] = useState(false);
          const [showAuth, setShowAuth] = useState(true);
          const [authMode, setAuthMode] = useState('login');
          const [aiInsights, setAiInsights] = useState({});
          const [isLoadingAI, setIsLoadingAI] = useState(false);
          const [showCommissionEditor, setShowCommissionEditor] = useState(false);
          const [currentTransaction, setCurrentTransaction] = useState(null);
          const [showUserManagement, setShowUserManagement] = useState(false);
          const [showAddUser, setShowAddUser] = useState(false);
          const [commissionStructure, setCommissionStructure] = useState({
            total_rate: 0.025,
            participants: [
              { role: 'deal_owner', user_id: null, percentage: 60, fixed_amount: 0, type: 'percentage' },
              { role: 'investor_owner', user_id: null, percentage: 40, fixed_amount: 0, type: 'percentage' }
            ]
          });

          // System users with access control
          const [systemUsers, setSystemUsers] = useState([
            { 
              id: 'admin1', 
              email: 'admin@vastgoed.nl', 
              password: 'admin123', 
              name: 'Beheerder', 
              company: 'Vastgoed Matcher Pro', 
              role: 'admin', 
              status: 'active',
              created_at: '2024-01-01T00:00:00Z'
            },
            { 
              id: 'user1', 
              email: 'jan@example.com', 
              password: 'password123', 
              name: 'Jan Vermeer', 
              company: 'Vermeer Vastgoed', 
              role: 'user', 
              status: 'active',
              created_at: '2024-01-10T10:00:00Z'
            },
            { 
              id: 'user2', 
              email: 'lisa@example.com', 
              password: 'password123', 
              name: 'Lisa de Vries', 
              company: 'De Vries Properties', 
              role: 'user', 
              status: 'pending',
              created_at: '2024-01-15T14:30:00Z'
            }
          ]);

          // Real OpenAI API call via Netlify function
          const callOpenAI = async (prompt, type = 'analysis', data = null) => {
            setIsLoadingAI(true);
            
            try {
              const response = await fetch('/.netlify/functions/openai-chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, type, data })
              });
              
              if (response.ok) {
                const result = await response.json();
                setIsLoadingAI(false);
                return result.data;
              }
            } catch (error) {
              console.error('API call failed, using mock data:', error);
            }
            
            // Fallback to mock data
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const mockResponses = {
              investor_analysis: {
                financialStrength: 'Hoog - Stabiele inkomstenbron via vastgoedbeleggingen',
                riskAppetite: 'Gemiddeld tot hoog - Ervaren investeerder met diversified portfolio',
                marketKnowledge: 'Goed - Actief in Nederlandse vastgoedmarkt sinds 2015',
                preferredSectors: ['Residentieel', 'Commercieel retail'],
                projectTypePreference: ['Turn-key', 'Renovatie'],
                investmentStrategy: 'Buy-and-hold met focus op cashflow generatie',
                recommendations: 'Geschikt voor deals met stabiele huurinkomsten en potentieel voor waardestijging',
                behaviorProfile: 'Voorzichtige beslisser, graag veel informatie vooraf',
                investmentTimeline: 'Zoekt deals voor Q2-Q3 2024',
                marketSentiment: 'Positief over vastgoedmarkt, maar voorzichtig met nieuwe projecten'
              },
              deal_analysis: {
                marketPosition: 'Aantrekkelijk - Locatie in groeiende wijk met goede bereikbaarheid',
                projectTypeAnalysis: 'Turn-key voordeel: Direct rendement, lagere ontwikkelingsrisico\'s',
                competitiveAnalysis: 'Vergelijkbare panden in de buurt hebben 5-7% rendement',
                riskFactors: [
                  'Mogelijke leegstand bij huurwisseling', 
                  'Onderhoudskosten oudere panden',
                  'Marktvolatiliteit bij economische onzekerheid'
                ],
                opportunities: [
                  'Huurverhoging mogelijk door renovatie', 
                  'Waardestijging door buurtverbetering',
                  'Turn-key voordeel: Direct rendement, lagere ontwikkelingsrisico\'s',
                  'Renovatie kansen: Waardecreatie door modernisering',
                  'Transformatie potentieel: Functiewijziging verhoogt marktwaarde'
                ],
                priceAnalysis: 'Marktconform geprijsd, kleine onderhandelingsruimte',
                recommendation: 'Aanbevolen voor conservatieve tot gemiddelde risico investeerders',
                marketTrends: 'Prijzen in dit gebied stijgen 3-5% per jaar',
                demographicAnalysis: 'Populair bij young professionals en small families',
                futureOutlook: 'Positieve ontwikkeling verwacht door infrastructuurprojecten'
              },
              smart_matching: {
                matchScore: 87,
                reasoningFactors: [
                  'Budget perfect match (€350k binnen €100k-€500k range)',
                  'Locatie voorkeur Amsterdam komt overeen',
                  'Risicoprofiel past bij deal karakteristieken',
                  'Verwacht rendement 5.5% boven minimum van 4%',
                  'Project type turn-key past bij conservatieve benadering'
                ],
                aiRecommendations: [
                  'Benadruk stabiele huurinkomsten in pitch',
                  'Vermeld turn-key voordeel: geen ontwikkelingsrisico',
                  'Vermeld renovatiepotentieel voor waardestijging',
                  'Deel marktanalyse van vergelijkbare panden',
                  'Toon demografische trends in de buurt'
                ],
                timingAdvice: 'Optimaal moment - investeerder recent actief in vergelijkbare deals',
                negotiationStrategy: 'Start met asking price, investeerder waardeert transparantie',
                successProbability: 0.72
              },
              market_insights: {
                regionalTrends: {
                  'Nederland': { growth: 4.2, hotspots: ['Amsterdam', 'Rotterdam'], outlook: 'Positief' },
                  'Duitsland': { growth: 3.8, hotspots: ['Berlijn', 'München'], outlook: 'Stabiel' },
                  'Frankrijk': { growth: 5.1, hotspots: ['Parijs', 'Lyon'], outlook: 'Zeer positief' },
                  'Spanje': { growth: 6.2, hotspots: ['Madrid', 'Barcelona'], outlook: 'Zeer positief' },
                  'Zwitserland': { growth: 2.8, hotspots: ['Zürich', 'Genève'], outlook: 'Conservatief' }
                },
                priceForecasts: {
                  'Amsterdam': '+3.5% next 12 months',
                  'Berlijn': '+2.8% next 12 months',
                  'Parijs': '+4.2% next 12 months',
                  'Madrid': '+5.1% next 12 months',
                  'Zürich': '+1.8% next 12 months'
                },
                bestOpportunities: [
                  'Studentenhuisvesting in universiteitssteden',
                  'Duurzame nieuwbouw in groeikernen',
                  'Herbestemming kantoren naar woningen',
                  'Vakantievastgoed in Spanje',
                  'Luxe vastgoed in Zwitserse steden',
                  'Turn-key studentenhuisvesting',
                  'Transformatie projecten in stadscentra'
                ]
              }
            };

            setIsLoadingAI(false);
            
            if (type === 'investor_analysis') return mockResponses.investor_analysis;
            if (type === 'deal_analysis') return mockResponses.deal_analysis;  
            if (type === 'smart_matching') return mockResponses.smart_matching;
            if (type === 'market_insights') return mockResponses.market_insights;
            
            return mockResponses.investor_analysis;
          };

          // Database functies
          const loadData = async () => {
            try {
              console.log('Loading demo data...');
              
              // Use systemUsers for user data
              setUsers(
                systemUsers
                  .filter(u => u.status === 'active')
                  .map(u => ({
                    id: u.id,
                    name: u.name,
                    email: u.email,
                    company: u.company,
                    role: u.role
                  }))
              );
            
              setInvestors([
                {
                  id: '1',
                  naam: 'Peter van der Berg',
                  email: 'peter@example.com',
                  telefoon: '06-12345678',
                  bedrijf: 'Berg Investments',
                  minBudget: 100000,
                  maxBudget: 500000,
                  voorkeursRegio: ['Nederland', 'Duitsland'],
                  voorkeursLocaties: ['Amsterdam', 'Rotterdam', 'Haarlem', 'Berlijn', 'München'],
                  vastgoedTypes: ['Appartement', 'Kantoor'],
                  projectTypes: ['Turn-key', 'Renovatie'],
                  risicoprofiel: 'Gemiddeld',
                  gewenstRendement: 6,
                  investeringshorizon: 'Lang termijn',
                  ervaringLevel: 'Ervaren',
                  beschikbaarheid: 'Direct',
                  communicatieVoorkeur: 'Telefoon',
                  investmentMotivatie: 'Uitbreiding van vastgoed portfolio voor pensioen opbouw',
                  owner_id: 'admin1',
                  created_at: '2024-01-15T10:30:00Z'
                },
                {
                  id: '2',
                  naam: 'Maria Jansen',
                  email: 'maria@example.com',
                  telefoon: '06-87654321',
                  bedrijf: 'Jansen Property',
                  minBudget: 200000,
                  maxBudget: 1000000,
                  voorkeursRegio: ['Frankrijk', 'Spanje'],
                  voorkeursLocaties: ['Utrecht', 'Den Haag', 'Parijs', 'Barcelona', 'Madrid'],
                  vastgoedTypes: ['Appartement', 'Retail', 'Studenten'],
                  projectTypes: ['Turn-key', 'Ontwikkeling'],
                  risicoprofiel: 'Conservatief',
                  gewenstRendement: 4,
                  investeringshorizon: 'Middellang',
                  ervaringLevel: 'Beginner',
                  beschikbaarheid: '1-3 maanden',
                  communicatieVoorkeur: 'Email',
                  investmentMotivatie: 'Eerste stappen in vastgoed beleggen, focus op stabiele inkomsten',
                  owner_id: 'user1',
                  created_at: '2024-01-20T14:15:00Z'
                },
                {
                  id: '3',
                  naam: 'David Chen',
                  email: 'david@example.com',
                  telefoon: '06-98765432',
                  bedrijf: 'Chen Capital',
                  minBudget: 500000,
                  maxBudget: 2000000,
                  voorkeursRegio: ['Nederland', 'Zwitserland'],
                  voorkeursLocaties: ['Amsterdam', 'Utrecht', 'Almere', 'Zürich', 'Genève'],
                  vastgoedTypes: ['Kantoor', 'Industrie', 'Zorgvastgoed'],
                  projectTypes: ['Transformatie', 'Ontwikkeling', 'Gemengd'],
                  risicoprofiel: 'Agressief',
                  gewenstRendement: 8,
                  investeringshorizon: 'Lang termijn',
                  ervaringLevel: 'Ervaren',
                  beschikbaarheid: 'Direct',
                  communicatieVoorkeur: 'WhatsApp',
                  investmentMotivatie: 'Institutionele belegger zoekt hoogrenderende vastgoed kansen',
                  owner_id: 'admin1',
                  created_at: '2024-01-25T16:45:00Z'
                }
              ]);
              
              setDeals([
                {
                  id: '1',
                  titel: 'Modern Appartement Amsterdam',
                  locatie: 'Amsterdam',
                  type: 'Appartement',
                  projectType: 'Turn-key',
                  prijs: 350000,
                  verwachtRendement: 5.5,
                  risico: 'Gemiddeld',
                  beschrijving: 'Kant-en-klaar nieuwbouw appartement in opkomende wijk Noord met metro verbinding',
                  oppervlakte: 85,
                  bouwjaar: 2020,
                  huurpotentie: 1800,
                  status: 'Beschikbaar',
                  owner_id: 'admin1',
                  created_at: '2024-01-10T09:00:00Z'
                },
                {
                  id: '2',
                  titel: 'Kantoorpand Rotterdam',
                  locatie: 'Rotterdam',
                  type: 'Kantoor',
                  projectType: 'Renovatie',
                  prijs: 750000,
                  verwachtRendement: 7.2,
                  risico: 'Hoog',
                  beschrijving: 'Kantoorpand voor renovatie in bedrijventerrein met parkeerplaatsen en uitbreidingsmogelijkheid',
                  oppervlakte: 400,
                  bouwjaar: 2015,
                  huurpotentie: 4500,
                  status: 'Beschikbaar',
                  owner_id: 'user1',
                  created_at: '2024-01-12T11:30:00Z'
                },
                {
                  id: '3',
                  titel: 'Studentencomplex Utrecht',
                  locatie: 'Utrecht',
                  type: 'Studenten',
                  projectType: 'Ontwikkeling',
                  prijs: 1200000,
                  verwachtRendement: 6.8,
                  risico: 'Laag',
                  beschrijving: 'Nieuwbouw ontwikkeling studentencomplex nabij universiteit met langetermijn contracten',
                  oppervlakte: 600,
                  bouwjaar: 2018,
                  huurpotentie: 6800,
                  status: 'Beschikbaar',
                  owner_id: 'admin1',
                  created_at: '2024-01-15T14:20:00Z'
                },
                {
                  id: '4',
                  titel: 'Retail Locatie Eindhoven',
                  locatie: 'Eindhoven',
                  type: 'Retail',
                  projectType: 'Transformatie',
                  prijs: 480000,
                  verwachtRendement: 4.5,
                  risico: 'Gemiddeld',
                  beschrijving: 'Transformatie project: voormalig kantoorpand naar retail in drukke winkelstraat',
                  oppervlakte: 120,
                  bouwjaar: 2010,
                  huurpotentie: 1800,
                  status: 'Beschikbaar',
                  owner_id: 'user1',
                  created_at: '2024-01-18T10:15:00Z'
                }
              ]);
              
              setTransactions([
                {
                  id: '1',
                  deal_id: '1',
                  investor_id: '1',
                  deal_owner_id: 'admin1',
                  investor_owner_id: 'admin1',
                  transaction_amount: 350000,
                  commission_rate: 0.025,
                  total_commission: 8750,
                  commission_structure: JSON.stringify({
                    total_rate: 0.025,
                    participants: [
                      { role: 'deal_owner', user_id: 'admin1', percentage: 60, fixed_amount: 0, type: 'percentage' },
                      { role: 'investor_owner', user_id: 'admin1', percentage: 40, fixed_amount: 0, type: 'percentage' }
                    ]
                  }),
                  participant_commissions: JSON.stringify([
                    { role: 'deal_owner', user_id: 'admin1', percentage: 60, commission_amount: 5250, type: 'percentage' },
                    { role: 'investor_owner', user_id: 'admin1', percentage: 40, commission_amount: 3500, type: 'percentage' }
                  ]),
                  status: 'completed',
                  closed_date: '2024-01-25T15:30:00Z'
                },
                {
                  id: '2',
                  deal_id: '2',
                  investor_id: '2',
                  deal_owner_id: 'user1',
                  investor_owner_id: 'user1',
                  transaction_amount: 750000,
                  commission_rate: 0.03,
                  total_commission: 22500,
                  commission_structure: JSON.stringify({
                    total_rate: 0.03,
                    participants: [
                      { role: 'deal_owner', user_id: 'user1', percentage: 40, fixed_amount: 0, type: 'percentage' },
                      { role: 'investor_owner', user_id: 'user1', percentage: 30, fixed_amount: 0, type: 'percentage' },
                      { role: 'referral', user_id: 'admin1', percentage: 30, fixed_amount: 0, type: 'percentage' }
                    ]
                  }),
                  participant_commissions: JSON.stringify([
                    { role: 'deal_owner', user_id: 'user1', percentage: 40, commission_amount: 9000, type: 'percentage' },
                    { role: 'investor_owner', user_id: 'user1', percentage: 30, commission_amount: 6750, type: 'percentage' },
                    { role: 'referral', user_id: 'admin1', percentage: 30, commission_amount: 6750, type: 'percentage' }
                  ]),
                  status: 'pending',
                  closed_date: null
                }
              ]);
              
              console.log('Demo data loaded successfully');
              
            } catch (error) {
              console.error('Error loading data:', error);
            }
          };
            
            setInvestors([
              {
                id: '1',
                naam: 'Peter van der Berg',
                email: 'peter@example.com',
                telefoon: '06-12345678',
                bedrijf: 'Berg Investments',
                minBudget: 100000,
                maxBudget: 500000,
                voorkeursRegio: ['Nederland', 'Duitsland'],
                voorkeursLocaties: ['Amsterdam', 'Rotterdam', 'Haarlem', 'Berlijn', 'München'],
                vastgoedTypes: ['Appartement', 'Kantoor'],
                projectTypes: ['Turn-key', 'Renovatie'],
                risicoprofiel: 'Gemiddeld',
                gewenstRendement: 6,
                investeringshorizon: 'Lang termijn',
                ervaringLevel: 'Ervaren',
                beschikbaarheid: 'Direct',
                communicatieVoorkeur: 'Telefoon',
                investmentMotivatie: 'Uitbreiding van vastgoed portfolio voor pensioen opbouw',
                owner_id: '1',
                created_at: '2024-01-15T10:30:00Z'
              },
              {
                id: '2',
                naam: 'Maria Jansen',
                email: 'maria@example.com',
                telefoon: '06-87654321',
                bedrijf: 'Jansen Property',
                minBudget: 200000,
                maxBudget: 1000000,
                voorkeursRegio: ['Frankrijk', 'Spanje'],
                voorkeursLocaties: ['Utrecht', 'Den Haag', 'Parijs', 'Barcelona', 'Madrid'],
                vastgoedTypes: ['Appartement', 'Retail', 'Studenten'],
                projectTypes: ['Turn-key', 'Ontwikkeling'],
                risicoprofiel: 'Conservatief',
                gewenstRendement: 4,
                investeringshorizon: 'Middellang',
                ervaringLevel: 'Beginner',
                beschikbaarheid: '1-3 maanden',
                communicatieVoorkeur: 'Email',
                investmentMotivatie: 'Eerste stappen in vastgoed beleggen, focus op stabiele inkomsten',
                owner_id: '2',
                created_at: '2024-01-20T14:15:00Z'
              },
              {
                id: '3',
                naam: 'David Chen',
                email: 'david@example.com',
                telefoon: '06-98765432',
                bedrijf: 'Chen Capital',
                minBudget: 500000,
                maxBudget: 2000000,
                voorkeursRegio: ['Nederland', 'Zwitserland'],
                voorkeursLocaties: ['Amsterdam', 'Utrecht', 'Almere', 'Zürich', 'Genève'],
                vastgoedTypes: ['Kantoor', 'Industrie', 'Zorgvastgoed'],
                projectTypes: ['Transformatie', 'Ontwikkeling', 'Gemengd'],
                risicoprofiel: 'Agressief',
                gewenstRendement: 8,
                investeringshorizon: 'Lang termijn',
                ervaringLevel: 'Ervaren',
                beschikbaarheid: 'Direct',
                communicatieVoorkeur: 'WhatsApp',
                investmentMotivatie: 'Institutionele belegger zoekt hoogrenderende vastgoed kansen',
                owner_id: '1',
                created_at: '2024-01-25T16:45:00Z'
              }
            ]);
            
            setDeals([
              {
                id: '1',
                titel: 'Modern Appartement Amsterdam',
                locatie: 'Amsterdam',
                type: 'Appartement',
                projectType: 'Turn-key',
                prijs: 350000,
                verwachtRendement: 5.5,
                risico: 'Gemiddeld',
                beschrijving: 'Kant-en-klaar nieuwbouw appartement in opkomende wijk Noord met metro verbinding',
                oppervlakte: 85,
                bouwjaar: 2020,
                huurpotentie: 1800,
                status: 'Beschikbaar',
                owner_id: '1',
                created_at: '2024-01-10T09:00:00Z'
              },
              {
                id: '2',
                titel: 'Kantoorpand Rotterdam',
                locatie: 'Rotterdam',
                type: 'Kantoor',
                projectType: 'Renovatie',
                prijs: 750000,
                verwachtRendement: 7.2,
                risico: 'Hoog',
                beschrijving: 'Kantoorpand voor renovatie in bedrijventerrein met parkeerplaatsen en uitbreidingsmogelijkheid',
                oppervlakte: 400,
                bouwjaar: 2015,
                huurpotentie: 4500,
                status: 'Beschikbaar',
                owner_id: '2',
                created_at: '2024-01-12T11:30:00Z'
              },
              {
                id: '3',
                titel: 'Studentencomplex Utrecht',
                locatie: 'Utrecht',
                type: 'Studenten',
                projectType: 'Ontwikkeling',
                prijs: 1200000,
                verwachtRendement: 6.8,
                risico: 'Laag',
                beschrijving: 'Nieuwbouw ontwikkeling studentencomplex nabij universiteit met langetermijn contracten',
                oppervlakte: 600,
                bouwjaar: 2018,
                huurpotentie: 6800,
                status: 'Beschikbaar',
                owner_id: '1',
                created_at: '2024-01-15T14:20:00Z'
              },
              {
                id: '4',
                titel: 'Retail Locatie Eindhoven',
                locatie: 'Eindhoven',
                type: 'Retail',
                projectType: 'Transformatie',
                prijs: 480000,
                verwachtRendement: 4.5,
                risico: 'Gemiddeld',
                beschrijving: 'Transformatie project: voormalig kantoorpand naar retail in drukke winkelstraat',
                oppervlakte: 120,
                bouwjaar: 2010,
                huurpotentie: 1800,
                status: 'Beschikbaar',
                owner_id: '2',
                created_at: '2024-01-18T10:15:00Z'
              }
            ]);
            
            setTransactions([
              {
                id: '1',
                deal_id: '1',
                investor_id: '1',
                deal_owner_id: '1',
                investor_owner_id: '1',
                transaction_amount: 350000,
                commission_rate: 0.025,
                total_commission: 8750,
                commission_structure: JSON.stringify({
                  total_rate: 0.025,
                  participants: [
                    { role: 'deal_owner', user_id: '1', percentage: 60, fixed_amount: 0, type: 'percentage' },
                    { role: 'investor_owner', user_id: '1', percentage: 40, fixed_amount: 0, type: 'percentage' }
                  ]
                }),
                participant_commissions: JSON.stringify([
                  { role: 'deal_owner', user_id: '1', percentage: 60, commission_amount: 5250, type: 'percentage' },
                  { role: 'investor_owner', user_id: '1', percentage: 40, commission_amount: 3500, type: 'percentage' }
                ]),
                status: 'completed',
                closed_date: '2024-01-25T15:30:00Z'
              },
              {
                id: '2',
                deal_id: '2',
                investor_id: '2',
                deal_owner_id: '2',
                investor_owner_id: '2',
                transaction_amount: 750000,
                commission_rate: 0.03,
                total_commission: 22500,
                commission_structure: JSON.stringify({
                  total_rate: 0.03,
                  participants: [
                    { role: 'deal_owner', user_id: '2', percentage: 40, fixed_amount: 0, type: 'percentage' },
                    { role: 'investor_owner', user_id: '2', percentage: 30, fixed_amount: 0, type: 'percentage' },
                    { role: 'referral', user_id: '3', percentage: 30, fixed_amount: 0, type: 'percentage' }
                  ]
                }),
                participant_commissions: JSON.stringify([
                  { role: 'deal_owner', user_id: '2', percentage: 40, commission_amount: 9000, type: 'percentage' },
                  { role: 'investor_owner', user_id: '2', percentage: 30, commission_amount: 6750, type: 'percentage' },
                  { role: 'referral', user_id: '3', percentage: 30, commission_amount: 6750, type: 'percentage' }
                ]),
                status: 'pending',
                closed_date: null
              }
            ]);
            
            console.log('Demo data geladen');
          };

          const getUserById = (id) => {
            return users.find(u => u.id === id) || { name: 'Onbekend', email: '' };
          };

          // Enhanced AI functions
          const getInvestorInsights = async (investorId) => {
            const investor = investors.find(i => i.id === investorId);
            const insights = await callOpenAI(`Analyseer investeerder profiel: ${JSON.stringify(investor)}`, 'investor_analysis', investor);
            setAiInsights(prev => ({
              ...prev,
              [`investor_${investorId}`]: insights
            }));
          };

          const getDealInsights = async (dealId) => {
            const deal = deals.find(d => d.id === dealId);
            const insights = await callOpenAI(`Analyseer vastgoed deal: ${JSON.stringify(deal)}`, 'deal_analysis', deal);
            setAiInsights(prev => ({
              ...prev,
              [`deal_${dealId}`]: insights
            }));
          };

          const getSmartMatchingInsights = async (dealId, investorId) => {
            const deal = deals.find(d => d.id === dealId);
            const investor = investors.find(i => i.id === investorId);
            const insights = await callOpenAI(`Smart matching analyse`, 'smart_matching', { deal, investor });
            setAiInsights(prev => ({
              ...prev,
              [`smart_match_${dealId}_${investorId}`]: insights
            }));
          };

          const getMarketInsights = async () => {
            const insights = await callOpenAI(`Markt inzichten`, 'market_insights');
            setAiInsights(prev => ({
              ...prev,
              market_insights: insights
            }));
          };

          // Auth functions with proper validation
          const handleLogin = async (credentials) => {
            try {
              console.log('Login attempt:', credentials.email);
              
              // Find user in system
              const foundUser = systemUsers.find(u => 
                u.email.toLowerCase() === credentials.email.toLowerCase() && 
                u.password === credentials.password
              );
              
              if (!foundUser) {
                alert('Ongeldige inloggegevens. Probeer opnieuw.');
                return;
              }
              
              if (foundUser.status === 'pending') {
                alert('Je account is nog niet goedgekeurd door een beheerder. Neem contact op voor toegang.');
                return;
              }
              
              if (foundUser.status === 'blocked') {
                alert('Je account is geblokkeerd. Neem contact op met de beheerder.');
                return;
              }
              
              // Successful login
              setUser({
                id: foundUser.id,
                name: foundUser.name,
                email: foundUser.email,
                company: foundUser.company,
                role: foundUser.role
              });
              
              setShowAuth(false);
              
              // Load data after successful login
              setTimeout(() => {
                loadData();
              }, 100);
              
              console.log('Login successful:', foundUser.name);
              
            } catch (error) {
              console.error('Login error:', error);
              alert('Er is een fout opgetreden bij het inloggen.');
            }
          };

          const handleRegister = async (userData) => {
            try {
              // Check if email already exists
              const existingUser = systemUsers.find(u => 
                u.email.toLowerCase() === userData.email.toLowerCase()
              );
              
              if (existingUser) {
                alert('Dit email adres is al geregistreerd.');
                return;
              }
              
              // Create new user (pending approval)
              const newUser = {
                id: 'user_' + Date.now(),
                email: userData.email,
                password: userData.password,
                name: userData.name,
                company: userData.company,
                role: 'user',
                status: 'pending', // Requires admin approval
                created_at: new Date().toISOString()
              };
              
              setSystemUsers(prev => [...prev, newUser]);
              
              alert('Registratie succesvol! Je account moet nog goedgekeurd worden door een beheerder. Je ontvangt bericht zodra je toegang hebt.');
              setAuthMode('login');
              
            } catch (error) {
              console.error('Registration error:', error);
              alert('Er is een fout opgetreden bij registreren.');
            }
          };

          const handleLogout = async () => {
            setUser(null);
            setShowAuth(true);
            setActiveTab('dashboard');
            setInvestors([]);
            setDeals([]);
            setTransactions([]);
            setUsers([]);
            setAiInsights({});
            setMatches([]);
            
            console.log('Uitgelogd');
          };

          // User Management Functions (Admin only)
          const handleUserStatusChange = (userId, newStatus) => {
            setSystemUsers(prev => 
              prev.map(user => 
                user.id === userId 
                  ? { ...user, status: newStatus }
                  : user
              )
            );
            console.log(`User ${userId} status changed to ${newStatus}`);
          };

          const handleAddNewUser = (userData) => {
            const newUser = {
              id: 'user_' + Date.now(),
              email: userData.email,
              password: userData.password || 'password123',
              name: userData.name,
              company: userData.company,
              role: userData.role || 'user',
              status: 'active',
              created_at: new Date().toISOString()
            };
            
            setSystemUsers(prev => [...prev, newUser]);
            setShowAddUser(false);
            console.log('New user added:', newUser);
          };

          const handleDeleteUser = (userId) => {
            if (userId === user.id) {
              alert('Je kunt je eigen account niet verwijderen.');
              return;
            }
            
            if (confirm('Weet je zeker dat je deze gebruiker wilt verwijderen?')) {
              setSystemUsers(prev => prev.filter(u => u.id !== userId));
              console.log('User deleted:', userId);
            }
          };

          useEffect(() => {
            if (user) {
              loadData();
            }
          }, [user]);

          // Enhanced matching algorithm with AI insights
          const calculateMatchScore = (investor, deal) => {
            let score = 0;
            let maxScore = 0;
            let reasoningFactors = [];

            // Budget matching (25%)
            maxScore += 25;
            if (deal.prijs >= investor.minBudget && deal.prijs <= investor.maxBudget) {
              score += 25;
              reasoningFactors.push(`✓ Budget perfect match (€${deal.prijs.toLocaleString()} binnen €${investor.minBudget.toLocaleString()}-€${investor.maxBudget.toLocaleString()} range)`);
            } else if (deal.prijs < investor.minBudget) {
              const budgetScore = Math.max(0, 25 - ((investor.minBudget - deal.prijs) / investor.minBudget * 25));
              score += budgetScore;
              reasoningFactors.push(`⚠ Deal prijs onder minimum budget (${budgetScore.toFixed(1)}/25 punten)`);
            } else {
              reasoningFactors.push(`✗ Deal prijs boven maximum budget`);
            }

            // Location matching (20%) - Enhanced with region support
            maxScore += 20;
            const locationMatch = investor.voorkeursLocaties?.includes(deal.locatie);
            const regionMatch = investor.voorkeursRegio?.some(regio => {
              const regioSteden = {
                'Nederland': ['Amsterdam', 'Rotterdam', 'Utrecht', 'Den Haag', 'Eindhoven', 'Tilburg', 'Haarlem', 'Almere', 'Breda', 'Nijmegen'],
                'Spanje': ['Madrid', 'Barcelona', 'Valencia', 'Sevilla', 'Zaragoza', 'Málaga', 'Murcia', 'Palma', 'Las Palmas', 'Bilbao'],
                'Duitsland': ['Berlijn', 'Hamburg', 'München', 'Keulen', 'Frankfurt', 'Stuttgart', 'Düsseldorf', 'Dortmund', 'Essen', 'Leipzig'],
                'Frankrijk': ['Parijs', 'Marseille', 'Lyon', 'Toulouse', 'Nice', 'Nantes', 'Strasbourg', 'Montpellier', 'Bordeaux', 'Lille'],
                'Zwitserland': ['Zürich', 'Genève', 'Basel', 'Lausanne', 'Bern', 'Winterthur', 'Luzern', 'St. Gallen', 'Lugano', 'Biel'],
                'Overig': ['Londen', 'Brussel', 'Milaan', 'Wenen', 'Praag', 'Budapest', 'Stockholm', 'Kopenhagen', 'Oslo', 'Helsinki']
              };
              return regioSteden[regio]?.includes(deal.locatie);
            });
            
            if (locationMatch) {
              score += 20;
              reasoningFactors.push(`✓ Exacte locatie match (${deal.locatie})`);
            } else if (regionMatch) {
              score += 15;
              reasoningFactors.push(`✓ Regio match (${deal.locatie} in voorkeursregio)`);
            } else {
              reasoningFactors.push(`✗ Locatie niet in voorkeuren`);
            }

            // Type vastgoed matching (15%)
            maxScore += 15;
            if (investor.vastgoedTypes?.includes(deal.type)) {
              score += 15;
              reasoningFactors.push(`✓ Vastgoed type match (${deal.type})`);
            } else if (investor.vastgoedTypes?.length > 0) {
              reasoningFactors.push(`✗ Vastgoed type niet in voorkeuren`);
            } else {
              score += 7; // Bonus voor geen specifieke voorkeur
              reasoningFactors.push(`~ Geen specifieke vastgoed type voorkeur`);
            }

            // Project type matching (10%)
            maxScore += 10;
            if (investor.projectTypes?.includes(deal.projectType)) {
              score += 10;
              reasoningFactors.push(`✓ Project type match (${deal.projectType})`);
            } else if (investor.projectTypes?.length > 0) {
              reasoningFactors.push(`✗ Project type niet in voorkeuren`);
            } else {
              score += 5; // Bonus voor geen specifieke voorkeur
              reasoningFactors.push(`~ Geen specifieke project type voorkeur`);
            }

            // Rendement matching (15%)
            maxScore += 15;
            if (deal.verwachtRendement >= investor.gewenstRendement) {
              score += 15;
              reasoningFactors.push(`✓ Rendement boven verwachting (${deal.verwachtRendement}% vs ${investor.gewenstRendement}%)`);
            } else {
              const rendementScore = Math.max(0, 15 - ((investor.gewenstRendement - deal.verwachtRendement) / investor.gewenstRendement * 15));
              score += rendementScore;
              reasoningFactors.push(`⚠ Rendement onder verwachting (${rendementScore.toFixed(1)}/15 punten)`);
            }

            // Risico matching (10%)
            maxScore += 10;
            const risicoMatch = {
              'Conservatief': { 'Laag': 10, 'Gemiddeld': 6, 'Hoog': 2 },
              'Gemiddeld': { 'Laag': 8, 'Gemiddeld': 10, 'Hoog': 7 },
              'Agressief': { 'Laag': 5, 'Gemiddeld': 8, 'Hoog': 10 }
            };
            const risicoScore = risicoMatch[investor.risicoprofiel]?.[deal.risico] || 0;
            score += risicoScore;
            reasoningFactors.push(`${risicoScore >= 8 ? '✓' : '⚠'} Risico match (${investor.risicoprofiel} profiel, ${deal.risico} risico)`);

            // Experience level bonus (5%)
            maxScore += 5;
            if (investor.ervaringLevel === 'Ervaren' && deal.risico === 'Hoog') {
              score += 5;
              reasoningFactors.push(`✓ Ervaren investeerder geschikt voor hoog risico`);
            } else if (investor.ervaringLevel === 'Beginner' && deal.risico === 'Laag') {
              score += 5;
              reasoningFactors.push(`✓ Beginner investeerder geschikt voor laag risico`);
            } else {
              score += 2;
            }

            // Availability bonus (5%)
            maxScore += 5;
            if (investor.beschikbaarheid === 'Direct') {
              score += 5;
              reasoningFactors.push(`✓ Direct beschikbaar voor investering`);
            } else {
              score += 2;
            }

            const finalScore = Math.round((score / maxScore) * 100);
            
            return {
              score: finalScore,
              reasoning: reasoningFactors,
              maxScore,
              actualScore: score
            };
          };

          const findMatches = (dealId) => {
            const deal = deals.find(d => d.id === dealId);
            if (!deal) return [];

            return investors.map(investor => {
              const matchResult = calculateMatchScore(investor, deal);
              return {
                investor,
                deal,
                matchScore: matchResult.score,
                reasoning: matchResult.reasoning,
                aiInsights: null // Will be populated when AI analysis is requested
              };
            }).sort((a, b) => b.matchScore - a.matchScore);
          };

          const createTransaction = async (dealId, investorId) => {
            const deal = deals.find(d => d.id === dealId);
            const investor = investors.find(i => i.id === investorId);
            
            if (!deal || !investor) return;

            const initialCommissionStructure = {
              total_rate: 0.025,
              participants: [
                { role: 'deal_owner', user_id: deal.owner_id, percentage: 60, fixed_amount: 0, type: 'percentage' },
                { role: 'investor_owner', user_id: investor.owner_id, percentage: 40, fixed_amount: 0, type: 'percentage' }
              ]
            };

            setCurrentTransaction({ deal, investor, dealId, investorId });
            setCommissionStructure(initialCommissionStructure);
            setShowCommissionEditor(true);
          };

          const finalizeTransaction = async () => {
            if (!currentTransaction) return;

            const { deal, investor, dealId, investorId } = currentTransaction;
            
            // Check if this is a preview (no real investor selected)
            if (investorId === 'preview') {
              alert('Dit is een preview. Ga naar "Matching" tab om een echte investeerder te selecteren.');
              return;
            }
            
            const totalCommission = deal.prijs * commissionStructure.total_rate;
            
            const participantCommissions = commissionStructure.participants.map(participant => {
              let commission = 0;
              if (participant.type === 'percentage') {
                commission = totalCommission * (participant.percentage / 100);
              } else if (participant.type === 'fixed') {
                commission = participant.fixed_amount;
              }
              return {
                ...participant,
                commission_amount: commission
              };
            });

            const transactionData = {
              id: Date.now().toString(),
              deal_id: dealId,
              investor_id: investorId,
              deal_owner_id: deal.owner_id,
              investor_owner_id: investor.owner_id,
              transaction_amount: deal.prijs,
              commission_rate: commissionStructure.total_rate,
              total_commission: totalCommission,
              commission_structure: JSON.stringify(commissionStructure),
              participant_commissions: JSON.stringify(participantCommissions),
              status: 'pending',
              closed_date: null
            };

            setTransactions(prev => [...prev, transactionData]);
            setShowCommissionEditor(false);
            setCurrentTransaction(null);
            
            // Reset commission structure
            setCommissionStructure({
              total_rate: 0.025,
              participants: [
                { role: 'deal_owner', user_id: null, percentage: 60, fixed_amount: 0, type: 'percentage' },
                { role: 'investor_owner', user_id: null, percentage: 40, fixed_amount: 0, type: 'percentage' }
              ]
            });
            
            console.log('Nieuwe transactie toegevoegd:', transactionData);
            
            // Navigate to transactions tab to show result
            setActiveTab('transactions');
          };

          const handleAddInvestor = async (investorData) => {
            const newInvestor = {
              ...investorData,
              id: Date.now().toString(),
              owner_id: user.id,
              created_at: new Date().toISOString()
            };
            
            setInvestors(prev => [...prev, newInvestor]);
            setShowAddInvestor(false);
            
            console.log('Nieuwe investeerder toegevoegd:', newInvestor);
          };

          const handleAddDeal = async (dealData) => {
            const newDeal = {
              ...dealData,
              id: Date.now().toString(),
              owner_id: user.id,
              created_at: new Date().toISOString()
            };
            
            setDeals(prev => [...prev, newDeal]);
            setShowAddDeal(false);
            
            console.log('Nieuwe deal toegevoegd:', newDeal);
          };

          const getMatchColor = (score) => {
            if (score >= 80) return 'text-green-600 bg-green-100';
            if (score >= 60) return 'text-yellow-600 bg-yellow-100';
            return 'text-red-600 bg-red-100';
          };

          const calculateCommissionSummary = () => {
            const userTransactions = transactions.filter(t => {
              if (t.participant_commissions) {
                const participants = JSON.parse(t.participant_commissions);
                return participants.some(p => p.user_id === user.id);
              }
              return t.deal_owner_id === user.id || t.investor_owner_id === user.id;
            });
            
            const totalCommission = userTransactions.reduce((sum, t) => {
              if (t.participant_commissions) {
                const participants = JSON.parse(t.participant_commissions);
                const userParticipant = participants.find(p => p.user_id === user.id);
                return sum + (userParticipant ? userParticipant.commission_amount : 0);
              }
              const userCommission = t.deal_owner_id === user.id ? (t.deal_owner_commission || 0) : (t.investor_owner_commission || 0);
              return sum + userCommission;
            }, 0);

            const completedTransactions = userTransactions.filter(t => t.status === 'completed');
            const pendingTransactions = userTransactions.filter(t => t.status === 'pending');

            return {
              totalCommission,
              completedTransactions: completedTransactions.length,
              pendingTransactions: pendingTransactions.length,
              totalVolume: userTransactions.reduce((sum, t) => sum + t.transaction_amount, 0)
            };
          };

          // Forms Components
          const InvestorForm = ({ onSubmit, onCancel }) => {
            const [formData, setFormData] = useState({
              naam: '',
              email: '',
              telefoon: '',
              bedrijf: '',
              minBudget: '',
              maxBudget: '',
              voorkeursRegio: [],
              voorkeursLocaties: [],
              vastgoedTypes: [],
              projectTypes: [],
              risicoprofiel: 'Gemiddeld',
              gewenstRendement: '',
              investeringshorizon: 'Middellang',
              ervaringLevel: 'Gemiddeld',
              investmentMotivatie: '',
              communicatieVoorkeur: 'Email',
              beschikbaarheid: 'Direct'
            });

            const regioSteden = {
              'Nederland': ['Amsterdam', 'Rotterdam', 'Utrecht', 'Den Haag', 'Eindhoven', 'Tilburg', 'Haarlem', 'Almere', 'Breda', 'Nijmegen'],
              'Spanje': ['Madrid', 'Barcelona', 'Valencia', 'Sevilla', 'Zaragoza', 'Málaga', 'Murcia', 'Palma', 'Las Palmas', 'Bilbao'],
              'Duitsland': ['Berlijn', 'Hamburg', 'München', 'Keulen', 'Frankfurt', 'Stuttgart', 'Düsseldorf', 'Dortmund', 'Essen', 'Leipzig'],
              'Frankrijk': ['Parijs', 'Marseille', 'Lyon', 'Toulouse', 'Nice', 'Nantes', 'Strasbourg', 'Montpellier', 'Bordeaux', 'Lille'],
              'Zwitserland': ['Zürich', 'Genève', 'Basel', 'Lausanne', 'Bern', 'Winterthur', 'Luzern', 'St. Gallen', 'Lugano', 'Biel'],
              'Overig': ['Londen', 'Brussel', 'Milaan', 'Wenen', 'Praag', 'Budapest', 'Stockholm', 'Kopenhagen', 'Oslo', 'Helsinki']
            };

            const handleRegioChange = (regio) => {
              setFormData(prev => {
                const newRegio = prev.voorkeursRegio.includes(regio)
                  ? prev.voorkeursRegio.filter(r => r !== regio)
                  : [...prev.voorkeursRegio, regio];
                
                // Auto-select cities in selected regions
                let newLocaties = [...prev.voorkeursLocaties];
                if (newRegio.includes(regio)) {
                  // Add cities from this region
                  regioSteden[regio].forEach(stad => {
                    if (!newLocaties.includes(stad)) {
                      newLocaties.push(stad);
                    }
                  });
                } else {
                  // Remove cities from this region
                  newLocaties = newLocaties.filter(stad => !regioSteden[regio].includes(stad));
                }

                return {
                  ...prev,
                  voorkeursRegio: newRegio,
                  voorkeursLocaties: newLocaties
                };
              });
            };

            const handleLocationChange = (location) => {
              setFormData(prev => ({
                ...prev,
                voorkeursLocaties: prev.voorkeursLocaties.includes(location)
                  ? prev.voorkeursLocaties.filter(l => l !== location)
                  : [...prev.voorkeursLocaties, location]
              }));
            };

            const handleProjectTypeChange = (type) => {
              setFormData(prev => ({
                ...prev,
                projectTypes: prev.projectTypes.includes(type)
                  ? prev.projectTypes.filter(t => t !== type)
                  : [...prev.projectTypes, type]
              }));
            };

            const handleTypeChange = (type) => {
              setFormData(prev => ({
                ...prev,
                vastgoedTypes: prev.vastgoedTypes.includes(type)
                  ? prev.vastgoedTypes.filter(t => t !== type)
                  : [...prev.vastgoedTypes, type]
              }));
            };

            const handleSubmit = (e) => {
              e.preventDefault();
              onSubmit(formData);
            };

            const handleCancel = () => {
              onCancel();
            };

            return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
              React.createElement('div', { className: 'bg-white rounded-lg w-full max-w-5xl h-full max-h-[95vh] flex flex-col' },
                // Header
                React.createElement('div', { className: 'p-6 border-b' },
                  React.createElement('div', { className: 'flex items-center justify-between' },
                    React.createElement('h3', { className: 'text-xl font-bold' }, 'Nieuwe Investeerder Toevoegen'),
                    React.createElement('button', { 
                      onClick: handleCancel,
                      className: 'text-gray-400 hover:text-gray-600' 
                    }, '✕')
                  )
                ),
                // Content
                React.createElement('div', { className: 'flex-1 overflow-y-auto p-6' },
                  React.createElement('form', { 
                    onSubmit: handleSubmit, 
                    id: 'investor-form' 
                  },
                    // Basic Info
                    React.createElement('div', { className: 'mb-8' },
                      React.createElement('h4', { className: 'text-lg font-semibold mb-4 text-gray-800' }, 'Basis Informatie'),
                      React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Naam *'),
                          React.createElement('input', {
                            type: 'text',
                            value: formData.naam,
                            onChange: (e) => setFormData({...formData, naam: e.target.value}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                            required: true
                          })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Email *'),
                          React.createElement('input', {
                            type: 'email',
                            value: formData.email,
                            onChange: (e) => setFormData({...formData, email: e.target.value}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                            required: true
                          })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Telefoon'),
                          React.createElement('input', {
                            type: 'tel',
                            value: formData.telefoon,
                            onChange: (e) => setFormData({...formData, telefoon: e.target.value}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500'
                          })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Bedrijf'),
                          React.createElement('input', {
                            type: 'text',
                            value: formData.bedrijf,
                            onChange: (e) => setFormData({...formData, bedrijf: e.target.value}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500'
                          })
                        )
                      )
                    ),
                    // Budget Info
                    React.createElement('div', { className: 'mb-8' },
                      React.createElement('h4', { className: 'text-lg font-semibold mb-4 text-gray-800' }, 'Budget & Financiën'),
                      React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Min Budget (€) *'),
                          React.createElement('input', {
                            type: 'number',
                            value: formData.minBudget,
                            onChange: (e) => setFormData({...formData, minBudget: parseInt(e.target.value)}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                            required: true
                          })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Max Budget (€) *'),
                          React.createElement('input', {
                            type: 'number',
                            value: formData.maxBudget,
                            onChange: (e) => setFormData({...formData, maxBudget: parseInt(e.target.value)}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                            required: true
                          })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Gewenst Rendement (%) *'),
                          React.createElement('input', {
                            type: 'number',
                            step: '0.1',
                            value: formData.gewenstRendement,
                            onChange: (e) => setFormData({...formData, gewenstRendement: parseFloat(e.target.value)}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                            required: true
                          })
                        ),
                        React.createElement('div', null,
                          React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Risicoprofiel'),
                          React.createElement('select', {
                            value: formData.risicoprofiel,
                            onChange: (e) => setFormData({...formData, risicoprofiel: e.target.value}),
                            className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500'
                          },
                            React.createElement('option', { value: 'Conservatief' }, 'Conservatief - Laag risico, stabiel rendement'),
                            React.createElement('option', { value: 'Gemiddeld' }, 'Gemiddeld - Balans tussen risico en rendement'),
                            React.createElement('option', { value: 'Agressief' }, 'Agressief - Hoog risico, hoog potentieel')
                          )
                        )
                      )
                    )
                  )
                ),
                // Footer
                React.createElement('div', { className: 'p-6 border-t bg-gray-50' },
                  React.createElement('div', { className: 'flex justify-end space-x-4' },
                    React.createElement('button', {
                      type: 'button',
                      onClick: handleCancel,
                      className: 'px-6 py-2 text-gray-600 border rounded-md hover:bg-gray-100'
                    }, 'Annuleren'),
                    React.createElement('button', {
                      type: 'submit',
                      form: 'investor-form',
                      className: 'px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700'
                    }, 'Investeerder Toevoegen')
                  )
                )
              )
            );
          };

          const DealForm = ({ onSubmit, onCancel }) => {
            const [formData, setFormData] = useState({
              titel: '',
              locatie: '',
              type: '',
              projectType: '',
              prijs: '',
              verwachtRendement: '',
              risico: 'Gemiddeld',
              beschrijving: '',
              oppervlakte: '',
              bouwjaar: '',
              huurpotentie: '',
              status: 'Beschikbaar'
            });

            const handleSubmit = (e) => {
              e.preventDefault();
              onSubmit(formData);
            };

            const handleCancel = () => {
              onCancel();
            };

            return React.createElement('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
              React.createElement('div', { className: 'bg-white rounded-lg w-full max-w-4xl h-full max-h-[95vh] flex flex-col' },
                // Header
                React.createElement('div', { className: 'p-6 border-b' },
                  React.createElement('div', { className: 'flex items-center justify-between' },
                    React.createElement('h3', { className: 'text-xl font-bold' }, 'Nieuwe Deal Toevoegen'),
                    React.createElement('button', { 
                      onClick: handleCancel,
                      className: 'text-gray-400 hover:text-gray-600' 
                    }, '✕')
                  )
                ),
                // Content
                React.createElement('div', { className: 'flex-1 overflow-y-auto p-6' },
                  React.createElement('form', { 
                    onSubmit: handleSubmit, 
                    id: 'deal-form' 
                  },
                    React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4 mb-6' },
                      React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Titel *'),
                        React.createElement('input', {
                          type: 'text',
                          value: formData.titel,
                          onChange: (e) => setFormData({...formData, titel: e.target.value}),
                          className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                          required: true
                        })
                      ),
                      React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Locatie *'),
                        React.createElement('select', {
                          value: formData.locatie,
                          onChange: (e) => setFormData({...formData, locatie: e.target.value}),
                          className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                          required: true
                        },
                          React.createElement('option', { value: '' }, 'Selecteer locatie'),
                          React.createElement('optgroup', { label: 'Nederland' },
                            React.createElement('option', { value: 'Amsterdam' }, 'Amsterdam'),
                            React.createElement('option', { value: 'Rotterdam' }, 'Rotterdam'),
                            React.createElement('option', { value: 'Utrecht' }, 'Utrecht'),
                            React.createElement('option', { value: 'Den Haag' }, 'Den Haag'),
                            React.createElement('option', { value: 'Eindhoven' }, 'Eindhoven'),
                            React.createElement('option', { value: 'Tilburg' }, 'Tilburg')
                          ),
                          React.createElement('optgroup', { label: 'Duitsland' },
                            React.createElement('option', { value: 'Berlijn' }, 'Berlijn'),
                            React.createElement('option', { value: 'München' }, 'München'),
                            React.createElement('option', { value: 'Hamburg' }, 'Hamburg'),
                            React.createElement('option', { value: 'Frankfurt' }, 'Frankfurt'),
                            React.createElement('option', { value: 'Keulen' }, 'Keulen')
                          ),
                          React.createElement('optgroup', { label: 'Frankrijk' },
                            React.createElement('option', { value: 'Parijs' }, 'Parijs'),
                            React.createElement('option', { value: 'Lyon' }, 'Lyon'),
                            React.createElement('option', { value: 'Marseille' }, 'Marseille'),
                            React.createElement('option', { value: 'Toulouse' }, 'Toulouse'),
                            React.createElement('option', { value: 'Nice' }, 'Nice')
                          ),
                          React.createElement('optgroup', { label: 'Spanje' },
                            React.createElement('option', { value: 'Madrid' }, 'Madrid'),
                            React.createElement('option', { value: 'Barcelona' }, 'Barcelona'),
                            React.createElement('option', { value: 'Valencia' }, 'Valencia'),
                            React.createElement('option', { value: 'Sevilla' }, 'Sevilla'),
                            React.createElement('option', { value: 'Málaga' }, 'Málaga')
                          ),
                          React.createElement('optgroup', { label: 'Zwitserland' },
                            React.createElement('option', { value: 'Zürich' }, 'Zürich'),
                            React.createElement('option', { value: 'Genève' }, 'Genève'),
                            React.createElement('option', { value: 'Basel' }, 'Basel'),
                            React.createElement('option', { value: 'Lausanne' }, 'Lausanne'),
                            React.createElement('option', { value: 'Bern' }, 'Bern')
                          ),
                          React.createElement('optgroup', { label: 'Overig' },
                            React.createElement('option', { value: 'Londen' }, 'Londen'),
                            React.createElement('option', { value: 'Brussel' }, 'Brussel'),
                            React.createElement('option', { value: 'Wenen' }, 'Wenen'),
                            React.createElement('option', { value: 'Milaan' }, 'Milaan')
                          )
                        )
                      ),
                      React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Type *'),
                        React.createElement('select', {
                          value: formData.type,
                          onChange: (e) => setFormData({...formData, type: e.target.value}),
                          className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                          required: true
                        },
                          React.createElement('option', { value: '' }, 'Selecteer type'),
                          React.createElement('option', { value: 'Appartement' }, 'Appartement'),
                          React.createElement('option', { value: 'Kantoor' }, 'Kantoor'),
                          React.createElement('option', { value: 'Retail' }, 'Retail'),
                          React.createElement('option', { value: 'Industrie' }, 'Industrie'),
                          React.createElement('option', { value: 'Woning' }, 'Woning'),
                          React.createElement('option', { value: 'Hotel' }, 'Hotel'),
                          React.createElement('option', { value: 'Studenten' }, 'Studenten'),
                          React.createElement('option', { value: 'Zorgvastgoed' }, 'Zorgvastgoed')
                        )
                      ),
                      React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Project Type *'),
                        React.createElement('select', {
                          value: formData.projectType,
                          onChange: (e) => setFormData({...formData, projectType: e.target.value}),
                          className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                          required: true
                        },
                          React.createElement('option', { value: '' }, 'Selecteer project type'),
                          React.createElement('option', { value: 'Turn-key' }, 'Turn-key - Kant-en-klaar'),
                          React.createElement('option', { value: 'Renovatie' }, 'Renovatie - Opknappen'),
                          React.createElement('option', { value: 'Transformatie' }, 'Transformatie - Functiewijziging'),
                          React.createElement('option', { value: 'Ontwikkeling' }, 'Ontwikkeling - Nieuwbouw'),
                          React.createElement('option', { value: 'Gemengd' }, 'Gemengd - Combinatie')
                        )
                      ),
                      React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Prijs (€) *'),
                        React.createElement('input', {
                          type: 'number',
                          value: formData.prijs,
                          onChange: (e) => setFormData({...formData, prijs: parseInt(e.target.value)}),
                          className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                          required: true
                        })
                      ),
                      React.createElement('div', null,
                        React.createElement('label', { className: 'block text-sm font-medium mb-1' }, 'Verwacht Rendement (%) *'),
                        React.createElement('input', {
                          type: 'number',
                          step: '0.1',
                          value: formData.verwachtRendement,
                          onChange: (e) => setFormData({...formData, verwachtRendement: parseFloat(e.target.value)}),
                          className: 'w-full p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                          required: true
                        })
                      )
                    )
                  )
                ),
                // Footer
                React.createElement('div', { className: 'p-6 border-t bg-gray-50' },
                  React.createElement('div', { className: 'flex justify-end space-x-4' },
                    React.createElement('button', {
                      type: 'button',
                      onClick: handleCancel,
                      className: 'px-6 py-2 text-gray-600 border rounded-md hover:bg-gray-100'
                    }, 'Annuleren'),
                    React.createElement('button', {
                      type: 'submit',
                      form: 'deal-form',
                      className: 'px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700'
                    }, 'Deal Toevoegen')
                  )
                )
              )
            );
          };

          // Auth Components
          const AuthForm = () => {
            const [formData, setFormData] = useState({
              email: '',
              password: '',
              name: '',
              company: ''
            });

            const handleSubmit = (e) => {
              e.preventDefault();
              if (authMode === 'login') {
                handleLogin(formData);
              } else {
                handleRegister(formData);
              }
            };

            return React.createElement('div', { className: 'min-h-screen bg-gray-50 flex items-center justify-center' },
              React.createElement('div', { className: 'max-w-md w-full bg-white rounded-lg shadow-md p-8' },
                React.createElement('div', { className: 'text-center mb-8' },
                  React.createElement('h1', { className: 'text-2xl font-bold text-gray-900' }, 'Vastgoed Matcher Pro'),
                  React.createElement('p', { className: 'text-gray-600 mt-2' },
                    authMode === 'login' ? 'Inloggen op je account' : 'Nieuw account aanmaken'
                  )
                ),

                // Demo login info
                authMode === 'login' && React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6' },
                  React.createElement('h4', { className: 'font-semibold text-blue-800 mb-2' }, 'Demo Login Gegevens:'),
                  React.createElement('div', { className: 'text-sm text-blue-700 space-y-1' },
                    React.createElement('p', null, '👑 Beheerder: admin@vastgoed.nl / admin123'),
                    React.createElement('p', null, '👤 Gebruiker: jan@example.com / password123'),
                    React.createElement('p', { className: 'text-xs text-blue-600 mt-2' }, 
                      'Nieuwe registraties vereisen goedkeuring van beheerder'
                    )
                  )
                ),

                React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
                  authMode === 'register' && [
                    React.createElement('div', { key: 'name' },
                      React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Naam'),
                      React.createElement('input', {
                        type: 'text',
                        value: formData.name,
                        onChange: (e) => setFormData({...formData, name: e.target.value}),
                        className: 'w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                        required: true
                      })
                    ),
                    React.createElement('div', { key: 'company' },
                      React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Bedrijf'),
                      React.createElement('input', {
                        type: 'text',
                        value: formData.company,
                        onChange: (e) => setFormData({...formData, company: e.target.value}),
                        className: 'w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                        required: true
                      })
                    )
                  ],
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Email'),
                    React.createElement('input', {
                      type: 'email',
                      value: formData.email,
                      onChange: (e) => setFormData({...formData, email: e.target.value}),
                      className: 'w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                      required: true
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Wachtwoord'),
                    React.createElement('input', {
                      type: 'password',
                      value: formData.password,
                      onChange: (e) => setFormData({...formData, password: e.target.value}),
                      className: 'w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500',
                      required: true
                    })
                  ),
                  React.createElement('button', {
                    type: 'submit',
                    className: 'w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition-colors'
                  }, authMode === 'login' ? 'Inloggen' : 'Account Aanmaken')
                ),

                React.createElement('div', { className: 'mt-6 text-center' },
                  React.createElement('button', {
                    onClick: () => setAuthMode(authMode === 'login' ? 'register' : 'login'),
                    className: 'text-blue-600 hover:text-blue-800 text-sm'
                  }, authMode === 'login' ? 'Geen account? Registreer hier' : 'Al een account? Login hier')
                )
              )
            );
          };

          // Admin Panel Component
          const AdminPanel = () => {
            const pendingUsers = systemUsers.filter(u => u.status === 'pending');
            const activeUsers = systemUsers.filter(u => u.status === 'active');
            const blockedUsers = systemUsers.filter(u => u.status === 'blocked');

            return React.createElement('div', null,
              React.createElement('div', { className: 'mb-8' },
                React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                  React.createElement('h2', { className: 'text-2xl font-bold' }, 'Gebruikersbeheer'),
                  React.createElement('button', {
                    onClick: () => setShowAddUser(true),
                    className: 'bg-blue-600 text-white px-4 py-2 rounded flex items-center space-x-2 hover:bg-blue-700'
                  },
                    React.createElement(Plus, { size: 20 }),
                    React.createElement('span', null, 'Nieuwe Gebruiker')
                  )
                ),

                // Statistics
                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-4 gap-6 mb-8' },
                  React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Totaal Gebruikers'),
                        React.createElement('p', { className: 'text-2xl font-bold text-gray-900' }, systemUsers.length)
                      ),
                      React.createElement(Users, { className: 'h-8 w-8 text-blue-600' })
                    )
                  ),
                  React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Actieve Gebruikers'),
                        React.createElement('p', { className: 'text-2xl font-bold text-green-600' }, activeUsers.length)
                      ),
                      React.createElement(UserCheck, { className: 'h-8 w-8 text-green-600' })
                    )
                  ),
                  React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Wachtend op Goedkeuring'),
                        React.createElement('p', { className: 'text-2xl font-bold text-yellow-600' }, pendingUsers.length)
                      ),
                      React.createElement(AlertCircle, { className: 'h-8 w-8 text-yellow-600' })
                    )
                  ),
                  React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                    React.createElement('div', { className: 'flex items-center justify-between' },
                      React.createElement('div', null,
                        React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Geblokkeerde Gebruikers'),
                        React.createElement('p', { className: 'text-2xl font-bold text-red-600' }, blockedUsers.length)
                      ),
                      React.createElement(Settings, { className: 'h-8 w-8 text-red-600' })
                    )
                  )
                )
              ),

              // Pending approvals
              pendingUsers.length > 0 && React.createElement('div', { className: 'mb-8' },
                React.createElement('h3', { className: 'text-lg font-semibold mb-4 text-yellow-700' }, 
                  `🔔 ${pendingUsers.length} gebruiker(s) wachten op goedkeuring`
                ),
                React.createElement('div', { className: 'space-y-4' },
                  pendingUsers.map(user =>
                    React.createElement('div', { 
                      key: user.id, 
                      className: 'bg-yellow-50 border border-yellow-200 rounded-lg p-4' 
                    },
                      React.createElement('div', { className: 'flex items-center justify-between' },
                        React.createElement('div', null,
                          React.createElement('h4', { className: 'font-semibold' }, user.name),
                          React.createElement('p', { className: 'text-sm text-gray-600' }, user.email),
                          React.createElement('p', { className: 'text-sm text-gray-600' }, user.company),
                          React.createElement('p', { className: 'text-xs text-gray-500' }, 
                            `Geregistreerd: ${new Date(user.created_at).toLocaleDateString()}`
                          )
                        ),
                        React.createElement('div', { className: 'space-x-2' },
                          React.createElement('button', {
                            onClick: () => handleUserStatusChange(user.id, 'active'),
                            className: 'bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700'
                          }, 'Goedkeuren'),
                          React.createElement('button', {
                            onClick: () => handleUserStatusChange(user.id, 'blocked'),
                            className: 'bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700'
                          }, 'Weigeren')
                        )
                      )
                    )
                  )
                )
              ),

              // All users table
              React.createElement('div', { className: 'bg-white rounded-lg shadow-md border' },
                React.createElement('div', { className: 'p-6' },
                  React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Alle Gebruikers'),
                  React.createElement('div', { className: 'overflow-x-auto' },
                    React.createElement('table', { className: 'w-full' },
                      React.createElement('thead', null,
                        React.createElement('tr', { className: 'border-b' },
                          React.createElement('th', { className: 'text-left py-2' }, 'Naam'),
                          React.createElement('th', { className: 'text-left py-2' }, 'Email'),
                          React.createElement('th', { className: 'text-left py-2' }, 'Bedrijf'),
                          React.createElement('th', { className: 'text-left py-2' }, 'Rol'),
                          React.createElement('th', { className: 'text-left py-2' }, 'Status'),
                          React.createElement('th', { className: 'text-left py-2' }, 'Acties')
                        )
                      ),
                      React.createElement('tbody', null,
                        systemUsers.map(systemUser =>
                          React.createElement('tr', { key: systemUser.id, className: 'border-b' },
                            React.createElement('td', { className: 'py-2' }, systemUser.name),
                            React.createElement('td', { className: 'py-2' }, systemUser.email),
                            React.createElement('td', { className: 'py-2' }, systemUser.company),
                            React.createElement('td', { className: 'py-2' },
                              React.createElement('span', { 
                                className: `px-2 py-1 rounded text-xs ${
                                  systemUser.role === 'admin' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'
                                }` 
                              }, systemUser.role === 'admin' ? 'Beheerder' : 'Gebruiker')
                            ),
                            React.createElement('td', { className: 'py-2' },
                              React.createElement('span', { 
                                className: `px-2 py-1 rounded text-xs ${
                                  systemUser.status === 'active' ? 'bg-green-100 text-green-800' :
                                  systemUser.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                                  'bg-red-100 text-red-800'
                                }` 
                              }, 
                                systemUser.status === 'active' ? 'Actief' :
                                systemUser.status === 'pending' ? 'Wachtend' : 'Geblokkeerd'
                              )
                            ),
                            React.createElement('td', { className: 'py-2' },
                              React.createElement('div', { className: 'space-x-2' },
                                systemUser.id !== user.id && React.createElement('select', {
                                  value: systemUser.status,
                                  onChange: (e) => handleUserStatusChange(systemUser.id, e.target.value),
                                  className: 'text-xs border rounded px-2 py-1'
                                },
                                  React.createElement('option', { value: 'active' }, 'Actief'),
                                  React.createElement('option', { value: 'pending' }, 'Wachtend'),
                                  React.createElement('option', { value: 'blocked' }, 'Geblokkeerd')
                                ),
                                systemUser.id !== user.id && React.createElement('button', {
                                  onClick: () => handleDeleteUser(systemUser.id),
                                  className: 'text-red-600 text-xs hover:underline'
                                }, 'Verwijder')
                              )
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            );
          };
            const commissionSummary = calculateCommissionSummary();
            const userInvestors = investors.filter(i => i.owner_id === user.id);
            const userDeals = deals.filter(d => d.owner_id === user.id);

            return React.createElement('div', null,
              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8' },
                React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                  React.createElement('div', { className: 'flex items-center justify-between' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Mijn Investeerders'),
                      React.createElement('p', { className: 'text-2xl font-bold text-gray-900' }, userInvestors.length)
                    ),
                    React.createElement(Users, { className: 'h-8 w-8 text-blue-600' })
                  )
                ),
                
                React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                  React.createElement('div', { className: 'flex items-center justify-between' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Mijn Deals'),
                      React.createElement('p', { className: 'text-2xl font-bold text-gray-900' }, userDeals.length)
                    ),
                    React.createElement(Building, { className: 'h-8 w-8 text-green-600' })
                  )
                ),
                
                React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                  React.createElement('div', { className: 'flex items-center justify-between' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Totale Commissie'),
                      React.createElement('p', { className: 'text-2xl font-bold text-gray-900' }, '€' + commissionSummary.totalCommission.toLocaleString())
                    ),
                    React.createElement(DollarSign, { className: 'h-8 w-8 text-purple-600' })
                  )
                ),
                
                React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-md border' },
                  React.createElement('div', { className: 'flex items-center justify-between' },
                    React.createElement('div', null,
                      React.createElement('p', { className: 'text-sm font-medium text-gray-600' }, 'Transactie Volume'),
                      React.createElement('p', { className: 'text-2xl font-bold text-gray-900' }, '€' + (commissionSummary.totalVolume / 1000000).toFixed(1) + 'M')
                    ),
                    React.createElement(TrendingUp, { className: 'h-8 w-8 text-orange-600' })
                  )
                )
              ),

              React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-6' },
                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 border' },
                  React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Recente Transacties'),
                  React.createElement('div', { className: 'space-y-3' },
                    transactions.slice(0, 5).map(transaction => {
                      const deal = deals.find(d => d.id === transaction.deal_id);
                      const investor = investors.find(i => i.id === transaction.investor_id);
                      
                      let userCommission = 0;
                      if (transaction.participant_commissions) {
                        const participants = JSON.parse(transaction.participant_commissions);
                        const userParticipant = participants.find(p => p.user_id === user.id);
                        userCommission = userParticipant ? userParticipant.commission_amount : 0;
                      } else {
                        userCommission = transaction.deal_owner_id === user.id ? (transaction.deal_owner_commission || 0) : (transaction.investor_owner_commission || 0);
                      }
                      
                      return React.createElement('div', { 
                        key: transaction.id, 
                        className: 'flex items-center justify-between p-3 bg-gray-50 rounded' 
                      },
                        React.createElement('div', null,
                          React.createElement('p', { className: 'font-medium' }, deal?.titel || 'Onbekende Deal'),
                          React.createElement('p', { className: 'text-sm text-gray-600' }, investor?.naam || 'Onbekende Investeerder')
                        ),
                        React.createElement('div', { className: 'text-right' },
                          React.createElement('p', { className: 'font-medium' }, '€' + transaction.transaction_amount.toLocaleString()),
                          React.createElement('p', { className: 'text-sm text-green-600' }, '+€' + userCommission.toLocaleString() + ' commissie'),
                          React.createElement('p', { 
                            className: `text-xs ${transaction.status === 'completed' ? 'text-green-600' : 'text-yellow-600'}` 
                          }, transaction.status === 'completed' ? 'Afgerond' : 'Pending')
                        )
                      );
                    })
                  )
                ),

                React.createElement('div', { className: 'bg-white rounded-lg shadow-md p-6 border' },
                  React.createElement('h3', { className: 'text-lg font-semibold mb-4' }, 'Lead Eigenaren'),
                  React.createElement('div', { className: 'space-y-3' },
                    users.map(user => {
                      const userInvestorCount = investors.filter(i => i.owner_id === user.id).length;
                      const userDealCount = deals.filter(d => d.owner_id === user.id).length;
                      return React.createElement('div', { 
                        key: user.id, 
                        className: 'flex items-center justify-between p-3 bg-gray-50 rounded' 
                      },
                        React.createElement('div', { className: 'flex items-center space-x-3' },
                          React.createElement(UserCheck, { className: 'h-5 w-5 text-blue-600' }),
                          React.createElement('div', null,
                            React.createElement('p', { className: 'font-medium' }, user.name),
                            React.createElement('p', { className: 'text-sm text-gray-600' }, user.company)
                          )
                        ),
                        React.createElement('div', { className: 'text-right' },
                          React.createElement('p', { className: 'text-sm' }, userInvestorCount + ' investeerders'),
                          React.createElement('p', { className: 'text-sm' }, userDealCount + ' deals')
                        )
                      );
                    })
                  )
                )
              )
            );
          };

          // Show auth form if not logged in
          if (showAuth || !user) {
            return React.createElement(AuthForm);
          }

          return React.createElement('div', { className: 'max-w-7xl mx-auto p-6' },
            // Header with user info
            React.createElement('div', { className: 'mb-8 flex justify-between items-center' },
              React.createElement('div', null,
                React.createElement('h1', { className: 'text-3xl font-bold text-gray-900 mb-2' }, 'Vastgoed Matcher Pro AI'),
                React.createElement('p', { className: 'text-gray-600' }, `Welkom terug, ${user.name}! AI-powered matching, internationale regio targeting, project type filtering & geavanceerde commissie structuren`),
                React.createElement('div', { className: 'flex items-center space-x-4 mt-2' },
                  React.createElement('span', { className: 'text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full' }, '🤖 AI-Enhanced'),
                  React.createElement('span', { className: 'text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full' }, '📍 Regio Matching'),
                  React.createElement('span', { className: 'text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded-full' }, '🏗️ Project Types'),
                  React.createElement('span', { className: 'text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full' }, '💰 Smart Commissies'),
                  user.role === 'admin' && React.createElement('span', { className: 'text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full' }, '👑 Beheerder')
                )
              ),
              React.createElement('div', { className: 'flex items-center space-x-4' },
                React.createElement('div', { className: 'text-right' },
                  React.createElement('div', { className: 'flex items-center space-x-2 text-gray-600' },
                    React.createElement(User, { size: 16 }),
                    React.createElement('span', null, user.name)
                  ),
                  React.createElement('div', { className: 'text-sm text-gray-500' },
                    user.company + ' • ' + (user.role === 'admin' ? 'Beheerder' : 'Gebruiker')
                  )
                ),
                React.createElement('button', {
                  onClick: handleLogout,
                  className: 'flex items-center space-x-2 text-gray-600 hover:text-red-600'
                },
                  React.createElement(LogOut, { size: 16 }),
                  React.createElement('span', null, 'Uitloggen')
                )
              )
            ),

            // Navigation
            React.createElement('div', { className: 'flex space-x-4 mb-6 overflow-x-auto' },
              React.createElement('button', {
                onClick: () => setActiveTab('dashboard'),
                className: `px-4 py-2 rounded flex items-center space-x-2 whitespace-nowrap ${
                  activeTab === 'dashboard' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'
                }`
              },
                React.createElement(TrendingUp, { size: 20 }),
                React.createElement('span', null, 'Dashboard')
              ),
              React.createElement('button', {
                onClick: () => setActiveTab('investors'),
                className: `px-4 py-2 rounded flex items-center space-x-2 whitespace-nowrap ${
                  activeTab === 'investors' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'
                }`
              },
                React.createElement(Users, { size: 20 }),
                React.createElement('span', null, `Investeerders (${investors.length})`)
              ),
              React.createElement('button', {
                onClick: () => setActiveTab('deals'),
                className: `px-4 py-2 rounded flex items-center space-x-2 whitespace-nowrap ${
                  activeTab === 'deals' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'
                }`
              },
                React.createElement(Building, { size: 20 }),
                React.createElement('span', null, `Deals (${deals.length})`)
              ),
              React.createElement('button', {
                onClick: () => setActiveTab('matching'),
                className: `px-4 py-2 rounded flex items-center space-x-2 whitespace-nowrap ${
                  activeTab === 'matching' ? 'bg-purple-600 text-white' : 'bg-gray-200 text-gray-700'
                }`
              },
                React.createElement(Star, { size: 20 }),
                React.createElement('span', null, 'AI Matching')
              ),
              React.createElement('button', {
                onClick: () => setActiveTab('transactions'),
                className: `px-4 py-2 rounded flex items-center space-x-2 whitespace-nowrap ${
                  activeTab === 'transactions' ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'
                }`
              },
                React.createElement(DollarSign, { size: 20 }),
                React.createElement('span', null, `Transacties (${transactions.length})`)
              ),
              // Admin only tab
              user.role === 'admin' && React.createElement('button', {
                onClick: () => setActiveTab('admin'),
                className: `px-4 py-2 rounded flex items-center space-x-2 whitespace-nowrap ${
                  activeTab === 'admin' ? 'bg-red-600 text-white' : 'bg-gray-200 text-gray-700'
                }`
              },
                React.createElement(Settings, { size: 20 }),
                React.createElement('span', null, 'Beheer')
              )
            ),

            // Dashboard Tab
            activeTab === 'dashboard' && React.createElement(Dashboard),

            // Investors Tab
            activeTab === 'investors' && React.createElement('div', null,
              React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                React.createElement('h2', { className: 'text-2xl font-bold' }, 'Investeerders'),
                React.createElement('button', {
                  onClick: () => setShowAddInvestor(true),
                  className: 'bg-blue-600 text-white px-4 py-2 rounded flex items-center space-x-2 hover:bg-blue-700'
                },
                  React.createElement(Plus, { size: 20 }),
                  React.createElement('span', null, 'Nieuwe Investeerder')
                )
              ),

              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6' },
                investors.map(investor =>
                  React.createElement('div', { 
                    key: investor.id, 
                    className: 'bg-white rounded-lg shadow-md p-6 border' 
                  },
                    React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                      React.createElement('h3', { className: 'text-xl font-semibold' }, investor.naam),
                      React.createElement('span', { 
                        className: `px-2 py-1 rounded text-xs ${
                          investor.risicoprofiel === 'Conservatief' ? 'bg-green-100 text-green-800' :
                          investor.risicoprofiel === 'Gemiddeld' ? 'bg-yellow-100 text-yellow-800' :
                          'bg-red-100 text-red-800'
                        }` 
                      }, investor.risicoprofiel)
                    ),

                    React.createElement('div', { className: 'space-y-2 text-sm' },
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(UserCheck, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, `Eigenaar: ${getUserById(investor.owner_id).name}`)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(Mail, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, investor.email)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(Phone, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, investor.telefoon)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(Euro, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, `€${investor.minBudget.toLocaleString()} - €${investor.maxBudget.toLocaleString()}`)
                      )
                    ),

                    React.createElement('div', { className: 'mt-4' },
                      React.createElement('p', { className: 'text-sm text-gray-600 mb-2' }, 'Interessegebieden:'),
                      React.createElement('div', { className: 'space-y-1' },
                        investor.vastgoedTypes.map(type =>
                          React.createElement('div', { 
                            key: type, 
                            className: 'flex items-center space-x-2' 
                          },
                            React.createElement('span', { className: 'w-2 h-2 bg-blue-500 rounded-full' }),
                            React.createElement('span', { className: 'text-sm' }, type)
                          )
                        )
                      )
                    ),

                    React.createElement('div', { className: 'mt-3' },
                      React.createElement('p', { className: 'text-sm text-gray-600 mb-2' }, 'Project Types:'),
                      React.createElement('div', { className: 'space-y-1' },
                        investor.projectTypes?.map(type =>
                          React.createElement('div', { 
                            key: type, 
                            className: 'flex items-center space-x-2' 
                          },
                            React.createElement('span', { className: 'w-2 h-2 bg-green-500 rounded-full' }),
                            React.createElement('span', { className: 'text-sm' }, type)
                          )
                        )
                      )
                    )
                  )
                )
              )
            ),

            // Deals Tab
            activeTab === 'deals' && React.createElement('div', null,
              React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                React.createElement('h2', { className: 'text-2xl font-bold' }, 'Deals'),
                React.createElement('button', {
                  onClick: () => setShowAddDeal(true),
                  className: 'bg-blue-600 text-white px-4 py-2 rounded flex items-center space-x-2 hover:bg-blue-700'
                },
                  React.createElement(Plus, { size: 20 }),
                  React.createElement('span', null, 'Nieuwe Deal')
                )
              ),

              React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-6' },
                deals.map(deal =>
                  React.createElement('div', { 
                    key: deal.id, 
                    className: 'bg-white rounded-lg shadow-md p-6 border' 
                  },
                    React.createElement('div', { className: 'flex items-center justify-between mb-4' },
                      React.createElement('h3', { className: 'text-xl font-semibold' }, deal.titel),
                      React.createElement('span', { 
                        className: `px-2 py-1 rounded text-xs ${
                          deal.risico === 'Laag' ? 'bg-green-100 text-green-800' :
                          deal.risico === 'Gemiddeld' ? 'bg-yellow-100 text-yellow-800' :
                          'bg-red-100 text-red-800'
                        }` 
                      }, `${deal.risico} risico`)
                    ),

                    React.createElement('div', { className: 'space-y-2 text-sm mb-4' },
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(UserCheck, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, `Eigenaar: ${getUserById(deal.owner_id).name}`)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(MapPin, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, deal.locatie)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(Building, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, deal.type)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(Target, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, deal.projectType)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(Euro, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, `€${deal.prijs.toLocaleString()}`)
                      ),
                      React.createElement('div', { className: 'flex items-center space-x-2' },
                        React.createElement(TrendingUp, { size: 16, className: 'text-gray-500' }),
                        React.createElement('span', null, `${deal.verwachtRendement}% rendement`)
                      )
                    ),

                    React.createElement('p', { className: 'text-sm text-gray-600 mb-4' }, deal.beschrijving),

                    React.createElement('div', { className: 'space-y-2' },
                      React.createElement('button', {
                        onClick: () => {
                          setMatches(findMatches(deal.id));
                          setActiveTab('matching');
                        },
                        className: 'w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 flex items-center justify-center space-x-2'
                      },
                        React.createElement(Star, { size: 16 }),
                        React.createElement('span', null, 'Vind Matches')
                      )
                    )
                  )
                )
              )
            ),

            // Admin Panel Tab (only for admins)
            activeTab === 'admin' && user.role === 'admin' && React.createElement(AdminPanel),

            // Modals
            showAddInvestor && React.createElement(InvestorForm, {
              onSubmit: handleAddInvestor,
              onCancel: () => setShowAddInvestor(false)
            }),

            showAddDeal && React.createElement(DealForm, {
              onSubmit: handleAddDeal,
              onCancel: () => setShowAddDeal(false)
            }),

            showAddUser && React.createElement(AddUserForm, {
              onSubmit: handleAddNewUser,
              onCancel: () => setShowAddUser(false)
            })
          );
        };

        ReactDOM.render(React.createElement(VastgoedInvesteerderMatcher), document.getElementById('root'));
    </script>
</body>
</html>
